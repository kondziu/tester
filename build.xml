<project name="Tester" basedir="." default="dist">

    <property file="build.properties"/>

    <target name="run" depends="jar">
        <echo>Create and populate a working directory at ${sandbox.dir}</echo>
        <copy todir="${sandbox.dir}">
            <fileset dir="${template.dir}" includes="**/*"/>
        </copy>
        <echo>Running app from ${build.dist.dir}/tester.jar</echo>
        <java jar="${build.dist.dir}/tester.jar"
              dir="${sandbox.dir}"
              fork="true"/>
    </target>

    <target name="clean">
        <echo>Cleaning generated files in ${build.dir}</echo>
        <delete dir="${build.dir}"/>
        <echo>Cleaning generated files in ${sandbox.dir}</echo>
        <delete dir="${sandbox.dir}"/>
    </target>

    <target name="compile">
        <echo>Compiling Java sources into ${build.classes.dir}</echo>
        <mkdir dir="${build.classes.dir}"/>
        <javac srcdir="${src.dir}"
               destdir="${build.classes.dir}"
               includeantruntime="false"
               sourcepath="${src.dir}"
               debug="${debug}"
               />
    </target>

    <target name="jar" depends="compile">
        <echo>Creating runnable jar file into ${build.dist.dir}</echo>
        <mkdir dir="${build.dist.dir}"/>
        <jar destfile="${build.dist.dir}/tester.jar"
             basedir="${build.classes.dir}">
            <fileset dir="${src.dir}" includes="**/*.java"/>
            <manifest>
                <attribute name="Main-Class"
                           value="${main-class}"/>    
            </manifest>
        </jar>
    </target>

    <target name="dist" depends="jar">
        <echo>Creating distributable files into ${build.dist.dir}</echo>
        <zip destfile="${build.dist.dir}/tester.zip">
            <!-- The runnable jar file -->
            <zipfileset dir="${build.dist.dir}/"
                        includes="tester.jar"
                        fullpath="tester/tester.jar"/>
            <!-- All default files except scripts (see below) -->
            <zipfileset dir="${template.dir}/"
                        includes="**/*"
                        excludes="**/*.sh"
                        prefix="tester/"/>
            <!-- Separate fileset for scripts to change permissions -->
            <zipfileset dir="${template.dir}/"
                        includes="**/*.sh"
                        filemode="755"
                        prefix="tester/"/>
        </zip>
    </target>

</project>
